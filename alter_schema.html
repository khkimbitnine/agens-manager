<link rel="stylesheet" href="/static/css/create_schema.css" />
<div class="content_wrapper">
	<form id="schemaForm">
		<div>
			<label for="name">SCHEMA NAME</label>
			<input type="hidden" name="oldName" id="oldName" />
			<input type="text" name="name" id="name" />
		</div>
		<ul id="schema">
			<li>
				<label>OWNER</label>
				<input type="hidden" name="oldOwner" id="oldOwner"></input>
				<select name="owner" id="owner"></select>
			</li>
			<li>
				<label>COMMENT</label>
				<input type="hidden" name="oldCmt" id="oldCmt"></input>
				<textarea name="comment" id="comment"></textarea>
			</li>
		</ul>
	</form>
	<div id="btnBox">
		<button id="alterBtn">Alter</button>
		<button id="backBtn">Back</button>
	</div>
</div>
<script>

	socket.emit('set_dbname',$(".db.on").text());
	
	socket.once("get_role", function(data) {
		
		for (var i = data.length - 1; i >= 0; i--) {
			
			$("#owner").append(
					'<option class="role" value="'+data[i]+'">' + data[i]
							+ '</option>');
			
		}
	});

	var namePattern = /^[a-zA-Z_][a-zA-Z_\d]+$/;
	var onePattern = /^[a-zA-Z_]+$/;	//In case name is one character

	var colPattern = /^[a-zA-Z_\d]+$/;
	var lengthPattern = /^[\d]+$/;
	var commentPattern = /^[a-zA-Z_\d\s]+$/;

	var $name = $("#name");
	var $comment = $("#comment");

	function notValid(notValid) {
		
		notValid.css("border", "2px solid red").addClass("notValid");
	}
	
	// Regular expression test & empty value test
	function validCheck() {
		
		$(".notValid").removeClass("notValid").css({
			
			"border" : "1px solid #aaa"
		});
		
		if (!namePattern.test($name.val()) && !onePattern.test($name.val())){
			
			notValid($name);
		}
			
		if (!commentPattern.test($comment.val()) && $comment.val() !== ''){
			
			notValid($comment);
		}

		if ($(".notValid").size() == 0) {
			
			socket.emit('alter_schema', $("#schemaForm").serializeArray());
			
			socket.once('schema_success', function(error){
				
				if(error==null){
					
					alert("Schema altered.");
					
				}else{
					
					alert(error);
				}
			});
		}

	}

	$("#alterBtn").click(function(e) {
		
		e.preventDefault();
		validCheck();
	});
	
	$("#backBtn").click(function(e){
		
		e.preventDefault();
		
		$.ajax({
			
			url:"db_content.html",
			success:function(data){
				
				$(".content").empty().html(data);
				socket.emit('set_dbname_schema', $(".db.on").text());
				
			}
		});
	});
</script>
