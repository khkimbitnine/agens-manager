<div class="content_wrapper">
	<form id="indexForm">
		<table>
			<tbody>
				<tr>
					<th colspan='4'>Index name</th>
				</tr>
				<tr>
					<td><input name="index_name" id="indexName" type="text" placeholder="optional"/></td>
				</tr>
				<tr>
					<th></th>
					<th>Databases</th>
					<th>Schemas</th>
					<th>Tables</th>
					<th>Columns</th>
					<th></th>
					<th></th>
					<th>Index</th>
				</tr>
				<tr>
					<td>
						<ul id="options">
							<li><label for = "access">Access method</label>
							<select name="access_method" id="access">
									<option value="">(default)</option>
									<option value="btree">btree</option>
									<option value="hash">hash</option>
									<option value="gist">gist</option>
									<option value="gin">gin</option>
									<option value="spgist">spgist</option>
							</select>
							</li>
							<li><label for="unique">Unique</label>
							<input id="unique" type="checkbox" class="checkbox" /> <input
								name="unique" value="0" type="hidden" /></li>
							<li><label for="concurrently">Concurrently</label>
							<input id="concurrently" type="checkbox" class="checkbox" /> <input
								name="concurrently" value="0" type="hidden" /></li>
						</ul>
					</td>
					<td><select name="database" class="database" size="6">
					</select></td>
					<td><select name="schema" class="schema" size="6">
					</select></td>
					<td><select name="table" class="table" size="6">
					</select></td>
					<td><select name="column" class="column" size="6">
					</select></td>
					<td>
						<ul>
							<li>
							<label for ="desc">DESC</label><input id="desc" type="checkbox" class="checkbox" />
							<label for="first">FIRST</label><input type="radio"
						class="order"/>
						<label for="last">LAST</label><input type="radio"
						class="order" checked/></li>
						</ul>
					</td>
					<td>
						<div id="btnBox">
							<button>add</button>
							<button>remove</button>
						</div>
					</td>
					<td><select name="index" class="index" multiple="multiple"></select>
					</td>
				</tr>
			</tbody>
		</table>
		<div>
			<button id="createBtn">Create</button>
			<button>Cancel</button>
		</div>
	</form>
</div>
<style>
#indexForm {
	color: #000;
}
</style>
<script>
 	var scname;
 	var pattern = /^[a-zA-Z_\d]+$/;

 	$(".checkbox").click(function(){
 		if($(this).is(':checked')){
	 		$(this).next().val(1);
 		}else{
	 		$(this).next().val(0);
 		}
 	});
	$(".order").click(function(){
		$(".order").not($(this)).prop('checked', false);
	});
 	$("#last").prop('checked', true).next().val(1);
 	
 	$.each(db, function(i){
 	$(".database").append("<option value='"+db[i]+"'>"+db[i]+"</option>");
 	});
 	
 	
 	$("#indexForm").on("click", "option", function(){
 		var parent = $(this).parent();
 		var name = $(this).text();
 		if(parent.hasClass("database")){
	 		$(".schema, .table, .column, .index").empty();
 	 		socket.emit('set_dbname', name);
 	 		socket.once('scname', function(data){
 	 			$.each(data.schema, function(i){
 	 				$(".schema").append("<option value='"+data.schema[i]+"'>"+data.schema[i]+"</option>");
 	 			});
 	 			socket.removeListener('scname');
 	 		});
 		}
 		if(parent.hasClass("schema")){
 			scname = name;
 			$(".table, .column, .index").empty();
 			socket.emit('set_scname_table', name);
 			socket.on('tabname', function(data){
 				$.each(data.table, function(i){
 					$(".table").append("<option value='"+data.table[i]+"'>"+data.table[i]+"</option>");
 				});
 				socket.removeListener('tabname');
 			});
 		}
 		if(parent.hasClass("table")){
 			$(".column, .index").empty();
 			socket.emit('set_tabname_col', {tabname: name, scname:scname});
 			socket.on('colname', function(data){
 				$.each(data.column, function(i){
 					$(".column").append("<option value='"+data.column[i]+"'>"+data.column[i]+"</option>");
 				});
 				socket.removeListener('colname');
 			});
 		}
 	});
 	
 	$("#btnBox>button").click(function(e){
 		e.preventDefault();
 		var column = $(".column>option:selected");
 		if($(this).index()==0){//add
 			
	 		var col = column.remove().appendTo(".index").prop('selected', false).text();
	 		
	 		if($("#desc").is(":checked")){
	 			col+=" DESC";
	 		}else{
	 			col+=" ASC";
	 		}
	 		if($(".order:eq(0)").is(":checked")) col+=" NULLS FIRST";
	 		if($(".order:eq(1)").is(":checked")) col+=" NULLS LAST";
	 		
	 		column.text(col).val(col);
	 		
 		}else{
 			var index = $(".index>option:selected");
 			var res = index.text().split(" ");
 			
	 		index.remove().appendTo(".column").prop('selected', false).text(res[0]).val(res[0]);
 		}
 	});
 	$("#createBtn").click(function(e){
 		e.preventDefault();
 		var idxVal = $("#indexName").val();
 		var test = pattern.test(idxVal);
 		var columns = [];
 		if(( test || idxVal === '' )&& $(".index").has('option').length!==0){
 			for(var i = 0 ; i < $(".index>option").length ; i++){
 				columns[i] = $(".index>option").eq(i).val();
 			}
 			
 		var formdata = $("#indexForm").serializeArray();
 		socket.emit('index_form', {form: formdata, column: columns});
 			
 		}else if(!test && idxVal !== ''){
 			alert("Index name should be a-z or A-Z or number.");
 		}else{
 			alert("Index should be selected.")
 		}
 	});
 	
</script>