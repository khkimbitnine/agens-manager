<div class="content_wrapper">
	<form id="schemaForm">
		<h2>Create schema</h2>
		<ul id="schema">
			<li><span>Name</span><input type="text" name="name" id="name" /></li>
			<li><span>Database</span><select id="database"></select></li>
			<li><span>Owner</span><select name="owner" id="owner"></select></li>
			<li><span>Comment</span>
			<textarea name="comment" id="comment"></textarea></li>
		</ul>
	</form>
	<button id="createBtn">Create</button>
	<button id="cancelBtn">Cancel</button>
</div>
<script>

	$("#database").append('<option>Select Database</option>');
	for(var i = 0 ; i < $(".db").length ; i++){
		$("#database").append("<option value='"+$(".db").eq(i).text()+"'>"+ $(".db").eq(i).text()+ "</option>")
	}
	
	$("#database").change(function(){
		$("#owner").empty();
		if($(this).find('option:selected').index()>0){
			socket.emit('set_dbname', {dbname: $(this).find('option:selected').val(), to:'create_schema'});
			socket.once("get_role", function(data) {
				for (var i = data.length - 1; i >= 0; i--) {
					$("#owner").append(
							'<option class="role" value="'+data[i]+'">' + data[i]
									+ '</option>');
				}
			});
		}
	})

	var namePattern = /^[a-zA-Z_][a-zA-Z_\d]+$/;
	var onePattern = /^[a-zA-Z_]+$/;//한글자일 경우

	var colPattern = /^[a-zA-Z_\d]+$/;
	var lengthPattern = /^[\d]+$/;
	var commentPattern = /^[a-zA-Z_\d\s\''\.]+$/;//	숫자 = \d 홑따옴표 = \'' 공백= \s 마침표 = \.

	var $name = $("#name");
	var $comment = $("#comment");

	function notValid(notValid) {
		notValid.css("border", "2px solid red").addClass("notValid");
	}

	function validCheck() {
		$(".notValid").removeClass("notValid").css({
			"border" : "1px solid #aaa"
		});//temp default border
		if (!namePattern.test($name.val()) && !onePattern.test($name.val()))
			notValid($name);
		if (!commentPattern.test($comment.val()) && $comment.val() !== '')
			notValid($comment);

		if ($(".notValid").size() == 0) {
			socket.emit('schema_form', $("#schemaForm").serializeArray());
		}

	}

	$("#createBtn").click(function(e) {
		e.preventDefault();
		validCheck();
	});
</script>
