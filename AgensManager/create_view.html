<link rel="stylesheet" href="public/css/create_view.css" />
<div class="content_wrapper">
	<form id="viewForm">
		<div>
			<label for="name">VIEW NAME</label>
			<input type="text" name="name" id="name"/>
		</div>
		<ul id="view">
			<li>
				<label>DB</label>
				<select id="dbList"></select>
			</li>
			<li>
				<label>QUERY</label>
				<textarea name='query' id='query'></textarea>
			</li>
			<li>
				<label>COMMENT</label>
				<textarea name='comment' id='comment'></textarea>
			</li>
		</ul>
	</form>
	<div id="btnBox">
		<button id="createBtn">Create</button>
		<button id="cancelBtn">Cancel</button>
	</div>
</div>
<script>
$("#dbList").append('<option>Select Database</option>');
for(var i = 0 ; i < $(".db").length ; i++){
	$("#dbList").append("<option value='"+$(".db").eq(i).text()+"'>"+ $(".db").eq(i).text()+ "</option>")
}

$("#dbList").change(function(){
	if($(this).find('option:selected').index()>0){
		socket.emit('set_dbname', $(this).find('option:selected').val());
	}
})

	$("#createBtn").click(function(e){
		e.preventDefault();
		validCheck();
		
	});
	var $name = $("#name");
	var $query = $("#query");
	var $comment = $("#comment");
	
	
	var pattern = /^[a-zA-Z_\d\s\''\.\*]+$/;//	숫자 = \d 홑따옴표 = \'' 공백= \s 마침표 = \.
	
	var namePattern = /^[a-zA-Z_][a-zA-Z_\d]+$/;
	var onePattern = /^[a-zA-Z_]+$/;//한글자일 경우
	
	
	function notValid(notValid){
		notValid.css("border", "2px solid red").addClass("notValid");
	}

	
	function validCheck(){
		
		$(".notValid").removeClass("notValid").css({"border": "1px solid #aaa"});//default border
		
		if(!namePattern.test($name.val()) && !onePattern.test($name.val())){
			notValid($name);
		}
		if(!pattern.test($query.val()) || $query.val()==''){
			notValid($query);
		}
		
		if(!pattern.test($comment.val()) && $comment.val()!==''){
			notValid($comment);
		}
		
		if($(".notValid").size()==0) {
			socket.emit('view_form', $("#viewForm").serializeArray());
		}
		
	}

</script>