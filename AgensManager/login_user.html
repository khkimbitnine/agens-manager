<div class="content_wrapper">
<form id="loginForm">
	<div id="username">
		<label>username</label> <input type="text" name="username" value="" />
	</div>
	<div id="passwd">
		<label>passwd</label> <input type="password" name="passwd" value="" />
	</div>
	<div id="loginBtnBox">
		<button>Cancel</button>
		<button>Login</button>
	</div>
	</form>
</div>
<script>
	
	var $loginBtn = $("#loginBtnBox").find("button").eq(1);
	function notValid($not){
		$not.css("border", "2px solid red").addClass("notValid");
	}
	
	var pattern = /^[a-zA-Z_][a-zA-Z_\d]+$/;
	var passwdPattern = /^[a-zA-Z_\d]+$/;
	
	function validCheck(){
		$(".notValid").removeClass("notValid").css({"border": "1px solid #aaa"});
		
		var $username = $("#username").children("input");
		var $passwd = $("#passwd").children("input");
		
		if($username.val().length == 0) notValid($username);
		if($username.val().length > 0 && !pattern.test($username.val())){
			notValid($username);
		}
		
		if($passwd.val().length == 0) notValid($passwd);
		if($passwd.val().length > 0 && !passwdPattern.test($passwd.val())){
			notValid($passwd);
		}
		
		if($(".notValid").size() == 0){
			
			socket.emit('login_check', $("#loginForm").serializeArray());
			
			socket.once('login_success', function(rs){
				if(rs.username && rs.passwd){
					console.log("logged in");
					$("#loginForm").remove();
					$(".content_wrapper").append("<div id='loginMsg'>"+$username.val()+" is logged in.</div>").find("#loginMsg").css("color", "#000");
					$("#reg").text($username.val());
					$("#login").text("log-out");
					socket.emit('login', {username: $username.val(), passwd: $passwd.val()});
				}
				if(rs.username && !rs.passwd){
					alert("The password isn't correct.");
					$passwd.val("").focus();					
				}
				if(!rs.username && !rs.passwd){
					alert("The username doesn't exist.")
					$username.val("").focus();					
				}
			});
		}
	}
	
	$loginBtn.click(function(e){
		e.preventDefault();
		validCheck();
	});

</script>