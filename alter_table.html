<link rel="stylesheet" href="/static/css/create_table.css" />
<div class="content_wrapper">
	<form id="tableForm">
		<ul>
			<li>
				<div class="field name">
					<div id="table">
						<label for="name">TABLE NAME</label>
						<input type="hidden" name="old_name" id="oldName"/>
						<input type="text" name="name" id="name" />
					</div>
				</div>
			</li>
			<li class="alter">
				<div id="schema" class="alter">
					<label for="schemaList">SCHEMA NAME</label> 
					<input type="hidden" name="old_schema" id="oldSchema"/>
					<select name="schema" id="schemaList">
					</select>
				</div>
				<div id="schema" class="alter">
					<label for="schemaList">OWNER</label>
					<input type="hidden" name="old_owner" id="oldOwner"/>
					<select name="owner" id="ownerList">
					</select>
				</div>
			</li>
			<li>
				<div class="field comment">
					<span>COMMENT</span>
					<input type="hidden" name="old_comt" id="oldCmt"/>
					<textarea name="comment" id="comment"></textarea>
				</div>
				<div id="btnBox" class="field">
					<button type="submit" id="alterBtn">Alter</button>
					<button>Cancel</button>
				</div>
			</li>
		</ul>
	</form>
	<div id="popupBG"></div>
</div>
<script>

var namePat = /^[a-zA-Z_][a-zA-Z_\d]+$/;
var onePat = /^[a-zA-Z_]+$/;	//one character
var txtPat = /^[a-zA-Z_\d\s]+$/;

function notValid(notValid) {
	
	notValid.css("border", "2px solid red").addClass("notValid");
	
}

function validCheck() {
	
	$(".notValid").removeClass("notValid").css({
		
		"border" : "1px solid #aaa"
			
	});

	var $schema = $("#schema");
	var $name = $("#name");

	if (!namePat.test($name.val()) && !onePat.test($name.val())){

		notValid($name);

	}

	if(!$("#schemaList").find('option:selected').index() ){

		notValid($("#schemaList"));

	}

	if (!$schema.children("option:selected").index() ) {
		
		notValid($schema);
		
	}


	var $comment = $("#comment");

	if (!txtPat.test($comment.val()) && $comment.val()){
		
		notValid($comment);
		
	}

	if (!$(".notValid").size()) {
		
		socket.emit('update_table', $("#tableForm").serializeArray());
		
		socket.once('table_success', function(error){
			
			if(error==null){

				alert("Table altered.");
				$.ajax({
					
					url:"schema_content.html",
					success:function(data){
						
						$(".content").empty().html(data);
						socket.emit('set_schema_table', $(".schema.on").text());
						
					}
				});

			}else{

				alert(error);
			}
		});
	}
}
	$("#alterBtn").click(function(e){
		e.preventDefault();
		validCheck();
	})
</script>

